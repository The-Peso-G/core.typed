#!/usr/bin/env clojure

(set! *warn-on-reflection* true)

(require '[clojure.java.io :as io]
         '[clojure.string :as str])

(def original-readme-file-lines
  (doall (-> "README.md" io/reader line-seq)))

(def version-string
  (some (fn [^String line]
          (when (.startsWith line "Latest stable release is")
            (subs line (count "Latest stable release is ") (dec (count line)))))
        original-readme-file-lines))

(def new-version-string
  (first *command-line-args*))

(assert (string? new-version-string)
        (str "Must pass version string to program"))

(def new-readme-file-lines
  (map #(str/replace % version-string new-version-string)
       original-readme-file-lines))

(spit "README.md" (str/join "\n" new-readme-file-lines))
